<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Auditoria - Google Sheets</title>
    <!-- Carrega Tailwind CSS para estilização fácil e responsiva -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#10b981', // Emerald green
                        'secondary': '#374151', // Gray-700
                    }
                }
            }
        }
    </script>
    <style>
        .container-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            background-color: white;
            transition: all 0.3s ease;
        }
        .container-card:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8 font-sans">

    <div id="app" class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-extrabold text-secondary mb-6 border-b-4 border-primary pb-2">
            Dashboard da Base de Auditoria
        </h1>

        <!-- Cartão Principal para Exibir os Dados -->
        <div class="container-card">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Dados Carregados (data_base_auditoria)</h2>
            
            <div id="loadingIndicator" class="text-center text-primary font-medium p-4 hidden">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-primary inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Carregando dados da planilha...
            </div>

            <div id="dataTableContainer" class="overflow-x-auto">
                <!-- A tabela de dados será inserida aqui -->
            </div>
            
            <p id="errorFeedback" class="text-red-600 font-medium mt-4 hidden"></p>
        </div>
    </div>

    <script>
        // --- URL CSV ATUALIZADO: Inclui o parâmetro 'output=csv' e 'gid=0' para a primeira aba. ---
        const SHEET_CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRuv4IvYqYqEKQOS52mr1L6-GJGQeLTdjNE3Ws7Oey4EI2VGO9CNwhZN4mbE_SkmAWP05AfLBDahsc5/pub?output=csv&gid=0'; 
        // ---------------------------------------------------------------------------------------
        
        const loadingIndicator = document.getElementById('loadingIndicator');
        const dataTableContainer = document.getElementById('dataTableContainer');
        const errorFeedback = document.getElementById('errorFeedback');

        /**
         * Converte uma string CSV em um array de objetos JavaScript.
         * Tenta detectar o separador (vírgula ou ponto e vírgula).
         * @param {string} csvText - O conteúdo CSV bruto.
         * @returns {Array<Object>} Um array de objetos com os dados.
         */
        function parseCSV(csvText) {
            if (!csvText) return [];
            
            const lines = csvText.trim().split('\n');
            if (lines.length <= 1) return []; // Deve ter pelo menos 1 linha de cabeçalho + 1 de dados
            
            const firstDataLine = lines[1];
            
            // Tenta detectar o separador: vírgula é o padrão para o Google Sheets em inglês, 
            // ponto e vírgula é comum em planilhas localizadas para português.
            let separator = ',';
            if ((firstDataLine.match(/,/g) || []).length < (lines[0].match(/,/g) || []).length) {
                // Se a primeira linha de dados tem menos vírgulas que o cabeçalho, 
                // e houver pontos e vírgulas, tenta ponto e vírgula.
                 if ((firstDataLine.match(/;/g) || []).length >= (lines[0].match(/;/g) || []).length) {
                    separator = ';';
                 }
            }

            const headers = lines[0].split(separator).map(header => header.trim().replace(/"/g, ''));
            
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                // Função auxiliar para lidar com CSVs simples, ignorando aspas internas
                let values = lines[i].split(separator).map(v => v.trim().replace(/"/g, ''));

                if (values.length !== headers.length) {
                    console.warn(`Linha ${i + 1} ignorada devido a número incorreto de colunas. Separador usado: ${separator}`);
                    continue; 
                }
                
                const row = {};
                for (let j = 0; j < headers.length; j++) {
                    row[headers[j]] = values[j];
                }
                data.push(row);
            }
            return data;
        }

        /**
         * Renderiza os dados em uma tabela HTML.
         * @param {Array<Object>} data - O array de dados a ser exibido.
         */
        function renderTable(data) {
            if (data.length === 0) {
                dataTableContainer.innerHTML = '<p class="text-gray-500">Nenhum dado encontrado ou planilha vazia.</p>';
                return;
            }

            const headers = Object.keys(data[0]);
            
            let html = `
                <table class="min-w-full divide-y divide-gray-200 border border-gray-100 rounded-lg">
                    <thead class="bg-gray-50">
                        <tr>
                            ${headers.map(h => `<th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${h}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;

            // Limita a exibição a 10 linhas para evitar sobrecarga no demo
            const displayData = data.slice(0, 10); 
            
            html += displayData.map(row => {
                return `
                    <tr>
                        ${headers.map(h => `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">${row[h]}</td>`).join('')}
                    </tr>
                `;
            }).join('');

            html += `
                    </tbody>
                </table>
            `;
            
            if (data.length > 10) {
                 html += `<p class="text-sm text-gray-500 mt-2">Exibindo apenas as primeiras 10 linhas de ${data.length} linhas.</p>`;
            }

            dataTableContainer.innerHTML = html;
        }

        /**
         * Função principal para carregar os dados da planilha.
         */
        async function carregarDadosAuditoria() {
            loadingIndicator.classList.remove('hidden');
            dataTableContainer.innerHTML = '';
            errorFeedback.classList.add('hidden');
            
            // Uma verificação de segurança: se faltar o parâmetro CSV, ainda assim avisa.
            if (!SHEET_CSV_URL.includes('output=csv')) {
                 errorFeedback.textContent = 'ERRO: O URL parece não estar no formato CSV. Certifique-se de que termina com ?output=csv&gid=0';
                 errorFeedback.classList.remove('hidden');
                 loadingIndicator.classList.add('hidden');
                 return;
            }

            try {
                const response = await fetch(SHEET_CSV_URL);
                
                if (!response.ok) {
                    throw new Error(`Erro de rede ou URL CSV inválido: ${response.statusText}`);
                }
                
                const csvText = await response.text();
                
                const dados = parseCSV(csvText);
                
                renderTable(dados);

            } catch (error) {
                console.error("Erro ao carregar dados da planilha:", error);
                errorFeedback.textContent = `Falha ao carregar dados: ${error.message}. Certifique-se de que a planilha está PUBLICADA na Web como CSV.`;
                errorFeedback.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Inicia o carregamento dos dados quando a janela carregar
        window.onload = carregarDadosAuditoria;
    </script>

</body>
</html>
